spring:
  application:
    name: oolshik-backend
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:oolshik}
    username: ${DB_USER:oolshik}
    password: ${DB_PASSWORD:oolshik}
  jpa:
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        format_sql: true
#        dialect:org.hibernate.spatial.dialect.postgis.PostgisDialect
        jdbc:
          time_zone: UTC
  flyway:
    enabled: true
    locations: classpath:db/migration
  messages:
    basename: messages
    fallback-to-system-locale: false
    encoding: UTF-8

  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
    consumer:
      group-id: ${KAFKA_CONSUMER_GROUP:oolshik-stt-backend}
      auto-offset-reset: earliest
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: com.oolshik.backend.transcription
        spring.json.use.type.headers: false
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      properties:
        spring.json.add.type.headers: false

  servlet:
    multipart:
      max-file-size: 45MB
      max-request-size: 50MB
server:
  port: 8080

firebase:
  project-id: ${FIREBASE_PROJECT_ID:dev-project}
  check-revoked: ${FIREBASE_CHECK_REVOKED:false}

app:
  jwt:
    secret: ${JWT_SECRET:CHANGEME_DEV_SECRET_32_CHARS_MINIMUM________}
    accessTokenTtlMinutes: 60
    refreshTokenTtlDays: 14
  otp:
    ttlSeconds: 300
    cooldownSeconds: 30
    maxAttempts: 5
  transcription:
    republishDelayMs: ${STT_REPUBLISH_DELAY_MS:30000}
    audioSourceMode: ${STT_AUDIO_SOURCE_MODE:REQUEST}
    demoAudioUrl: ${STT_DEMO_AUDIO_URL:https://github.com/voxserv/audio_quality_testing_samples/raw/refs/heads/master/mono_44100/127389__acclivity__thetimehascome.wav}
    s3AllowedHostSuffixes: ${STT_S3_ALLOWED_HOST_SUFFIXES:.amazonaws.com,.cloudfront.net}
    rewriteLocalPublicStreamForWorker: ${STT_REWRITE_LOCAL_PUBLIC_STREAM_FOR_WORKER:true}
    localWorkerBaseUrl: ${STT_LOCAL_WORKER_BASE_URL:http://api:8080}
  task-recovery:
    acceptToStartSlaSeconds: ${ACCEPT_TO_START_SLA_SECONDS:420}
    assignmentTtlSeconds: ${ASSIGNMENT_TTL_SECONDS:2700}
    authTtlSeconds: ${AUTH_TTL_SECONDS:120}
    maxReassign: ${MAX_REASSIGN:2}
    schedulerBatchSize: ${TASK_RECOVERY_BATCH_SIZE:100}
    schedulerDelayMs: ${TASK_RECOVERY_DELAY_MS:60000}
  radius-expansion:
    scheduleMeters: ${RADIUS_SCHEDULE_METERS:1000,2000,3000,5000}
    escalationDelaysSeconds: ${ESCALATION_DELAYS_SECONDS:0,120,300,600}
    maxRadiusMeters: ${MAX_RADIUS_METERS:5000}
    locationFreshnessHours: ${LOCATION_FRESHNESS_HOURS:24}
    jobIntervalSeconds: ${JOB_INTERVAL_SECONDS:30}
    batchSize: ${RADIUS_EXPANSION_BATCH_SIZE:100}
  kafka:
    topics:
      sttJobs: ${KAFKA_TOPIC_STT_JOBS:stt.jobs}
      sttResults: ${KAFKA_TOPIC_STT_RESULTS:stt.results}
      sttDlq: ${KAFKA_TOPIC_STT_DLQ:stt.jobs.dlq}
      notificationEvents: ${KAFKA_TOPIC_NOTIFICATION_EVENTS:notification.events}

  notification:
    activeWindowMinutes: ${NOTIF_ACTIVE_WINDOW_MINUTES:15}
    outboxPublishIntervalMs: ${NOTIF_OUTBOX_PUBLISH_INTERVAL_MS:2000}
    outboxBatchSize: ${NOTIF_OUTBOX_BATCH_SIZE:50}
    outboxMaxAttempts: ${NOTIF_OUTBOX_MAX_ATTEMPTS:8}
  payment:
    expirySweepIntervalMs: ${PAYMENT_EXPIRY_SWEEP_INTERVAL_MS:60000}
  feedback:
    maxPerDay: ${FEEDBACK_MAX_PER_DAY:10}
    rateLimitWindowHours: ${FEEDBACK_RATE_LIMIT_WINDOW_HOURS:24}
    retentionDays: ${FEEDBACK_RETENTION_DAYS:365}
    retentionPurgeIntervalMs: ${FEEDBACK_RETENTION_PURGE_INTERVAL_MS:86400000}

logging:
  level:
    org.springframework.security: INFO
    org.hibernate.SQL: DEBUG
    com.oolshik.backend: DEBUG
    org.springframework.web: INFO
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE

management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: never

media:
  storage: local   # local | s3

  local:
    root: ./data/audio
    publicStreamEnabled: ${MEDIA_LOCAL_PUBLIC_STREAM_ENABLED:false}

  s3:
    bucket: your-bucket-name
    region: ap-south-1
    prefix: audio/
    # endpoint: http://localhost:9000
    # pathStyleAccessEnabled: true
